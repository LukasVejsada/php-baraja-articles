Апострофи та лапки
==================

> id: '526ad995-3412-446e-bb56-9627dff8e29e'
> slug:
> 	cs: apostrofy-a-uvozovky
> 	uk: apostrofi-ta-lapki
> 
> perex:
> 	- Použití uvozovek a apostrofů pro ohraničení řetězců v PHP. Escapování řetězců a řešení kontextů.
> 	- Використання лапок та апострофів для розділення рядків у PHP. Екранування рядків та роздільна здатність контексту.
> 
> publicationDate: '2019-08-22 20:48:46'
> mainCategoryId: '0d2bed76-dcd2-4ceb-a4d7-174b74d96cc1'
> sourceContentHash: c5b0bf8b74238134be5348f886591e2a

Для розділення рядків можна використовувати лапки або апострофи. Особисто я віддаю перевагу тільки **апострофам**, якщо це не спеціальний символ розриву рядка або табуляція.

На це є низка причин, давайте пройдемося по них конструктивно.

> Основною причиною відмови від лапок є безпека та некоректна робота з типами даних.

Використання HTML-тегів всередині рядка
--------------------------------

Якщо нам потрібно повернути HTML-код в рядку, а ми загортаємо рядок в лапки, то доводиться досить незручно ескейпити:

```php
return "<a href=\"{$link}\">{$text}</a>";
```

Або зробити те ж саме у більш читабельному вигляді, зберігши цитати без втеч:

```php
return '<a href="' . $link . '">' . $text . '</a>';
```

Більша візуальна відстань рядка від змінної
---------------------------------------------

Немає нічого гіршого, ніж розміщення змінних всередині рядка безпосередньо один над одним, де ви не можете швидко візуально визначити, що є змінною, а що рядком:

```php
$url = "{$baseImageUrl}/{$dirName}/{$basename}.{$ext}";
```

Така нотація не має негативного впливу на функціональність, лише окремі змінні та фіксовані символи з рядка розташовуються занадто близько один до одного, що погіршує читабельність.

Спробуємо ще раз зробити його більш читабельним:

```php
$url = $baseImageUrl . '/' . $dirName . '/' . $basename . '.' . $ext;
```

Основна перевага, яку я бачу - це чистота навколо змінних, де не заважають зайві символи в назві.

Крім того, буде легше обгортати і в рядку не буде символів обгортання ;)

```php
$url = $baseImageUrl
       . '/' . $dirName
       . '/' . $basename . '.' . $ext;
```

Неможливо викликати функцію всередині лапок
---------------------------------------

А от змінна може, саме тому "щось" додається за межами рядка (особливо функції), а змінні записуються назад всередину. А іноді програміст навіть додає змінну після рядка. Словом, плутанина через плутанину.

Чому ми не можемо робити все однаково?

Некоректне приведення іншого типу даних до рядка
---------------------------------------------------

Розглянемо наступний виклик функції:

```php
echo getFullName("{$user->name}");

function getFullName(string $name): string
{
	// ... впровадження ...
}
```

Є можливість вставляти змінні в лапки, що призведе до їх перезапису у вигляді рядка. Однак, якщо змінна знаходиться в самому рядку і має тип даних, відмінний від рядка, то інформація про початковий тип даних може бути пошкоджена. Наприклад, якщо конструкція `$user->name` поверне `false` або `null`, ми не зможемо сказати, що це була помилка.

Програма завжди повинна розпізнавати стан помилки та належним чином виходити з ладу, а не ігнорувати його. Належна звітність про помилки призводить до кращого налагодження в майбутньому.

Іноді ви можете зіткнутися з перевизначеннями, особливо якщо функція вимагає певного типу даних:

```php
trim("{$returnText}");
```

В такому випадку я більш схильний це записати:

```php
trim ((string) $returnText);
```

яка не є такою "магічною" і навіть для менш досвідчених користувачів очевидно, що сталося зі змінною.

Видалення значення `null` з бази даних
----------------------------------

Припустимо, ми отримуємо назву готелю з бази даних:

```php
return "{$row->hotel->name}";
```

Але що робити, якщо імені не існує і воно є "нульовим"? Використовуючи лапки, ми створили потенційно важко виявлену помилку, оскільки вона буде переписана в порожній рядок. Однак ми хотіли б повернути реальний "нуль". Має значення, якщо запис не існує, або існує, але не заповнений.

Тому правильніше було б нічого не вказувати:

```php
return $row->hotel->name;
```

Чи вимагає функція повернення певного типу даних і чи є вона суворою щодо цього? Якщо ми не можемо задовольнити специфікацію, ми повинні зробити виняток.

```php
function getHotelName(int $hotelId): string
{
   // імплементація

   if ($row->hotel->name === null) {
      throw new \Exception('Назва готелю не існує.');
   }

   return $row->hotel->name;
}
```

Неузгодженість кодування символів і типів даних
--------------------------------------------

Нерідко можна зустріти конструкції на кшталт:

```php
echo "{$returnCode}" . self::CRLF;
```

Що краще написати як:

```php
echo $returnCode . "\n";
```

Використання лапок навколо змінної в даному випадку є зайвим і лише ускладнює читання, оскільки є зайвими символами. В той же час, обгортка рядка типу `CRLF` не є сучасною і краще використовувати тільки `\n`, яка є рідною для кодування `UTF-8`.

Насправді, ми все ще можемо перевірити тип даних для коду. Наприклад, що це номер і, можливо, повернути заміну. Це можна зробити за допомогою <a href="/ternary-operator">термінального оператора</a>:

```php
echo (is_int($returnCode) ? $returnCode : '?') . "\n";
```

> Примітка: Використання функції `is_int()` свідчить про погане проектування програми, тому що ніколи не повинно статися так, що ми не знаємо тип даних змінної.

Обертання виведеного рядка в апострофи
---------------------------------------

Часто в тексті виключення виникає необхідність заключити рядок виводу зі змінної в лапки або апострофи. Однак, це невиправдано створює "виграш" для обох типів роздільників рядків, і якщо рядок починається і закінчується одним і тим же символом, неможливо швидко визначити однозначно, де рядок починався і закінчувався у випадку декількох рядків, якщо всередині з'являється апостроф:

```php
throw new \Exception(__METHOD__ . ": Unsupported data type '{$fileType}'");
```

Особисто я вирішую цю проблему, укладаючи його в інший тип символів (мені добре підходять квадратні дужки), так що початок і кінець рядка можна елегантно побачити:

```php
throw new \Exception(__METHOD__ . ': Непідтримуваний тип даних [' . $fileType . ']');
```

Або:

```php
throw new \Exception("Status '{$status}' is invalid");
```

Можливий обмін на:

```php
throw new \Exception('Статус [' . $status . '] є недійсним');
```

Парсинг по рядках
--------------------

Лапки корисні, наприклад, для розбору з нового рядка:

```php
foreach(explode("\n", $text) as $line) {
	// імплементація
}
```

Вони були спеціально створені для цієї мети.

Однак, якщо вам потрібно обробити більш складний документ (наприклад, вихідний код мови програмування або HTML-сторінку), рекомендую використовувати **Tokenizer** разом з <a href="/regex">регулярними виразами</a>.

Не поєднувати два способи огородження
-----------------------------------

Якщо з якихось причин ви все одно збираєтесь використовувати лапки, принаймні, дотримуйтесь їх послідовності в усьому тексті.

Це стримуючий випадок:

```php
throw new \Exception("Зображення за URL-адресою не існує. ResponseSize:" . strlen($result) . ')');
```

Де початок рядка виділяється лапками, а кінець - апострофами.

Цей дефект виникає особливо при використанні інструментів автоматичного форматування (таких як **Code Sniffer**), які намагаються уніфікувати конвенції, але не завжди досягають успіху.
